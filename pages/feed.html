<div class="preloader-wrapper active">
	<div class="spinner-layer spinner-red-only">
		<div class="circle-clipper left"><div class="circle"></div></div>
		<div class="gap-patch"><div class="circle"></div></div>
		<div class="circle-clipper right"><div class="circle"></div></div>
	</div>
</div>
<script type="text/javascript">
	this.vote = function(id, elem) {
		let disabled = elem.classList.contains("disabled")
		return fetch(_app.make([
			"choices",
			id,
			disabled ? "unvote" : "vote",
		]), {
			headers: http.handlers.head(),
			method: "put",
		}).then(function(resp) {
			return resp.json()
		}).then(function(json) {
			for(let i=0; i<elem.parentNode.childElementCount; i++) {
				elem.parentNode.children[i].classList.remove("disabled")
				continue
			}
			if(!disabled) {
				elem.classList.add("disabled")
			}
			return json
		})
	}
	http.get(_app.make([
			"polls",
			"latest",
		]), function(data) {
		let self = document.querySelector("main")
		self.innerHTML = ""
		data.forEach(function(poll, i) {
			let options = ""
			for(let i=0; i<poll.choices.length; i++) {
				let self = poll.choices[i]
				options += `<a _class="waves-effect waves-light btn" href="#"
					onclick="vote(${self.id}, this)" >${self.text}</a>`
				continue
			}
			self.innerHTML += (`
				<div class="col s12 m6">
					<div class="card blue-grey darken-1">
						<div class="card-content white-text">
							<span class="card-title">${poll.title}</span>
							<p>${poll.description}</p>
						</div>
						<div class="card-action">
							${options}
						</div>
					</div>
				</div>
			`)
			return
		})
		self.innerHTML += (`
			<a href="#.1" >next</a>
		`)
		return
	})
</script>
